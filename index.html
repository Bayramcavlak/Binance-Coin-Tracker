<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
  <title>Binance Coin Tracker</title>
</head>

<body>
  <div class="container" id="app">

    <div class="pt-3 d-flex justify-content-end">
      <button v-if="isRefresh" class="btn btn-md btn-outline-primary p-3" @click="refreshTracker">
        Refresh
      </button>
      <button class="btn btn-md btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modalForAddSymbol"
        @click="openModalForAdd">
        Add Symbol
      </button>
    </div>

    <hr>

    <div class="col">
      <div class="col-12">

        <ul class="list-group pt-2" v-for="list,index in listed_coins">
          <li v-if="index==0" class="list-group-item position-relative d-flex justify-content-between align-items-center">
            <span>{{list}}-<p>LastPrice - WeightedAvgprice</p></span>
            <span><button class="btn btn-sm btn-danger">remove</button></span>
          </li>

          <li v-if="index!=0" class="list-group-item position-relative d-flex justify-content-between align-items-center">
            <span>{{list}}-<p>LastPrice - WeightedAvgprice</p></span>
            <span><button class="btn btn-sm btn-danger">remove</button></span>
          </li>

        </ul>

      </div>
    </div>

    <!-- Modal For Add Symbol-->
    <div class="modal fade" id="modalForAddSymbol">
      <div class="modal-dialog">
        <div class="modal-content" style="border-radius: 5px;">
          <div class="modal-body" style="height: 300px;">

            <div class="container p-3">
              <div class="form-group col-12">

                <div class="input-group mb-3">
                  <input type="text" class="form-control" placeholder="search symbols" @input="searchSymbols">
                </div>

                <div class="input-group">
                  <select class="form-select" v-model="selected_symbol">
                    <option disabled value="">Please select symbol</option>
                    <option :value="coin.name" v-for="coin in symbol_list">
                      {{coin.name}} - {{coin.lastPrice}}
                    </option>
                  </select>
                  <button class="btn btn-success" type="button" @click="addCoinToList">
                    Add
                  </button>
                </div>

              </div>

            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    var app = new Vue({
      el: "#app",
      data: {
        symbols: [],
        symbol_list: [],
        listed_coins: [],
        selected_symbol: '',
        search_symbols: '',
        isRefresh: false,
        apiBaseUrl: "https://api2.binance.com/api/v3/ticker/24hr",
      },
      methods: {

        openModalForAdd() {
          this.parseSembols()
        },

        refreshTracker() {
          //
        },

        addCoinToList() {
         this.listed_coins.push(this.selected_symbol)
         console.log("select:", this.listed_coins)
        },

        searchSymbols() {
          const searchText = (event.target.value).toUpperCase()

          if (searchText === '') {
            this.parseSembols()
          }
          const filtered = this.symbol_list.filter(
            f => f.name.includes(searchText) || f.lastPrice.includes(searchText)
          )
          this.symbol_list = filtered

        },

        /* get symbols from Binance */
        async getSymbolsFromBinance() {
          response = await fetch(this.apiBaseUrl, {
            method: "GET",
          });
          const data = await response.json()
          this.symbols = data.sort((a, b) => a.symbol > b.symbol)
          // console.log(this.symbols)
        },

        parseSembols() {
          this.symbol_list = this.symbols.map(coin => {
            return {
              name: coin.symbol,
              lastPrice: coin.lastPrice
            }
          })
        }
      },

      created() {
        this.getSymbolsFromBinance()
          .then(() => { this.parseSembols() })
      },
    });
  </script>
</body>

</html>